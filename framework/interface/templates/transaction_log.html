{% extends base.html %}

{% block title %}Transaction Log{% end %}

{% block includes %}
<script type="text/javascript" charset="utf-8" src="/static/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf-8" src="/static/js/dataTables.bootstrap.js"></script>
<link href="/static/css/dataTables.bootstrap.css" rel="stylesheet">
{% end %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <table id="transactionLog" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th> ID </th>
                    <th> Link </th>
                    <th> Scope </th>
                    <th> Seconds </th>
                    <th> Time </th>
                    <th> Status </th>
                    <th> Method </th>
                    <th> URL </th>
                    <th> Data </th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script>
var mySpace = {
                    max_id:0,
                    transactions_api_url:"{{ transactions_api_url }}",
                    transaction_log_url:"{{ transaction_log_url }}"
                  };
function addTransactions(data, status, xhr){
    $.each(data, function(index, obj){
            jQuery('#transactionLog').dataTable().fnAddData([
                                                obj.id,
                                                '<a href="'+mySpace.transaction_log_url+obj.id+'"><span class="btn btn-primary btn-sm"><i class="fa fa-chevron-circle-right"></i> View</span></a>',
                                                obj.scope,
                                                obj.time_human,
                                                obj.time,
                                                obj.response_status,
                                                obj.method,
                                                obj.url,
                                                obj.data
                                                ]);
            mySpace.max_id = obj.id;
            });
}

function updateTransactions(){
    $.getJSON( mySpace.transactions_api_url+"?id[gt]="+mySpace.max_id, addTransactions);
    setTimeout(updateTransactions , 5000);
}
$(document).ready(function() {
        updateTransactions();
        $('#transactionLog').dataTable({
                                            "bAutoWidth": false
                                        });
});
</script>
{% end %}
